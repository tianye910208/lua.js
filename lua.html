<html>
    <meta charset="utf-8">
    <head>
        <script type='text/javascript'>
            var Module = {
                postRun: [ update ],
                print: function(text) {
                    if (arguments.length > 1) 
                        text = Array.prototype.slice.call(arguments).join(' ');
                    console.log(text);

                    if(text != "emsc")
                        document.getElementById("show").innerHTML += "<br>\n" + text;
                },
                printErr: function(text) {
                    if (arguments.length > 1) 
                        text = Array.prototype.slice.call(arguments).join(' ');

                    console.log("[E]" + text);
                    
                },
                onRuntimeInitialized: function() {
                    console.log("onRuntimeInitialized");
                }
            };

            var timer;
            function update() {
                clearTimeout(timer);
                input = document.getElementById("edit").value;
                timer = setTimeout(function() {
                    document.getElementById("show").innerHTML = "";

                    var buf = intArrayFromString(input).concat(0);
                    var ptr = Module._malloc(buf.length);
                    Module.HEAPU8.set(buf, ptr);
                    Module._exec(ptr);
                    Module._free(ptr);

                }, 1000);
            }
        </script>
        <script type='text/javascript' src='lua.asm.js'></script>
    </head>
    <body>
        <div>
            <textarea id="edit" style="width: 800px; height: 480px;" onkeyup="update();">print("Hello Lua")</textarea>
            <div id="show" style="width: 800px;"></div>
        </div>
    </body>
</html>